---
import '@/styles/global.css'
---

<!doctype html>
<html lang="en" data-webtui-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="preconnect" href="https://cdn.jsdelivr.net" />
        <script is:inline>
            const storedTheme = localStorage.getItem('webtui-theme')
            const systemTheme = window.matchMedia(
                '(prefers-color-scheme: dark)',
            ).matches
                ? 'dark'
                : 'light'
            document.documentElement.setAttribute(
                'data-webtui-theme',
                storedTheme ?? systemTheme,
            )
        </script>
        <meta name="generator" content={Astro.generator} />
        <title>Sam Foreman</title>

        <!-- Icon(s) -->
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="icon" type="image/png" sizes="64x64" href="/favicon.png" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" href="/logo@512.png" />

        <!-- OpenGraph / X Title -->
        <meta property="og:title" content="Sam Foreman" />
        <meta name="twitter:title" content="Sam Foreman" />

        <!-- OpenGraph / X Description -->
        <meta name="description" content="Sam Foreman's Personal Website" />
        <meta name="og:description" content="Sam Foreman's Personal Website" />
        <meta
            name="twitter:description"
            content="Sam Foreman's Personal Website"
        />

        <!-- OpenGraph / X Cover Image -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:image" content="https://sam.onl/cover.png" />
        <meta property="og:image" content="https://sam.onl/cover.png" />
        <meta property="og:image:type" content="image/png" />
        <meta property="og:image:width" content="1920" />
        <meta property="og:image:height" content="1200" />

        <!-- Misc Metadata -->
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://sam.onl" />
        <meta name="twitter:site" content="@saforem2" />
        <meta name="twitter:creator" content="@saforem2" />
        <meta name="twitter:url" content="https://sam.onl" />
        <meta
            name="keywords"
            content="blog,machine learning,deep learning,artificial intelligence,supercomputing,programming,technology,sam foreman"
        />
        <meta name="theme-color" content="#1c1c1c" />

        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://iosevka-webfonts.github.io/iosevka/Iosevka.css"
            rel="stylesheet"
        />
        <style is:inline>
            svg[id^='mermaid-'] {
                display: block;
                width: 100%;
                max-width: 100%;
                height: auto !important;
                min-height: 12rem;
            }
        </style>
        <script is:inline>
            const normalizeMermaidSvgSize = () => {
                const mermaidSvgs = document.querySelectorAll("svg[id^='mermaid-']")

                mermaidSvgs.forEach((node) => {
                    const viewBox = node.getAttribute('viewBox')
                    if (!viewBox) return

                    const parts = viewBox
                        .trim()
                        .split(/\s+/)
                        .map((value) => Number(value))
                    if (parts.length !== 4) return

                    const width = parts[2]
                    const height = parts[3]
                    if (!Number.isFinite(width) || !Number.isFinite(height)) return
                    if (width <= 0 || height <= 0) return

                    node.setAttribute('width', String(width))
                    node.setAttribute('height', String(height))
                    node.style.width = '100%'
                    const renderedWidth =
                        node.getBoundingClientRect().width ||
                        node.parentElement?.getBoundingClientRect().width ||
                        width
                    const renderedHeight = (renderedWidth * height) / width
                    const resolvedHeight =
                        Number.isFinite(renderedHeight) && renderedHeight > 0
                            ? renderedHeight
                            : height

                    node.style.setProperty('height', `${resolvedHeight}px`, 'important')
                    node.style.setProperty('min-height', `${resolvedHeight}px`, 'important')
                    node.style.setProperty('width', '100%', 'important')
                    node.style.setProperty('max-width', '100%', 'important')
                    node.style.setProperty('display', 'block', 'important')
                })
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', normalizeMermaidSvgSize, {
                    once: true,
                })
            } else {
                normalizeMermaidSvgSize()
            }

            window.addEventListener('load', normalizeMermaidSvgSize, { once: true })
            setTimeout(normalizeMermaidSvgSize, 0)
            setTimeout(normalizeMermaidSvgSize, 50)
            setTimeout(normalizeMermaidSvgSize, 250)
            window.addEventListener('resize', normalizeMermaidSvgSize)
        </script>
        <!-- <link -->
        <!--     href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,400..600;1,400..600&display=swap" -->
        <!--     rel="stylesheet" -->
        <!-- /> -->
    </head>
    <body>
        <slot />
        <script type="module">
            const MAIN_FOCUS_SELECTOR = '#main-content, main, [role="main"]'

            const isNaturallyFocusable = (element) =>
                element.matches(
                    'a[href], button, input, textarea, select, summary, [tabindex]:not([tabindex="-1"])',
                )

            const focusMainRegion = () => {
                if (window.location.hash.length > 0) return

                const mainRegion = document.querySelector(MAIN_FOCUS_SELECTOR)
                if (!(mainRegion instanceof HTMLElement)) return

                const firstMainChild = mainRegion.firstElementChild
                const target =
                    firstMainChild instanceof HTMLElement
                        ? firstMainChild
                        : mainRegion

                const activeElement = document.activeElement
                if (
                    activeElement instanceof HTMLElement &&
                    activeElement !== document.body &&
                    activeElement !== document.documentElement
                ) {
                    return
                }

                if (!isNaturallyFocusable(target)) {
                    if (mainRegion.id === 'main-content') {
                        target.setAttribute('tabindex', '0')
                    } else {
                        target.setAttribute('tabindex', '-1')
                    }
                }

                target.focus({ preventScroll: true })
            }

            focusMainRegion()

            const stabilizeMermaidSvgLayout = () => {
                const mermaidSvgs = document.querySelectorAll('svg[id^="mermaid-"]')

                mermaidSvgs.forEach((node) => {
                    if (!(node instanceof SVGElement)) return

                    const viewBox = node.getAttribute('viewBox')
                    if (!viewBox) return

                    const [, , widthRaw, heightRaw] = viewBox
                        .trim()
                        .split(/\s+/)
                        .map((value) => Number(value))

                    if (!Number.isFinite(widthRaw) || !Number.isFinite(heightRaw)) {
                        return
                    }

                    if (widthRaw <= 0 || heightRaw <= 0) return

                    node.setAttribute('width', String(widthRaw))
                    node.setAttribute('height', String(heightRaw))
                    node.style.setProperty('display', 'block', 'important')
                    node.style.setProperty('width', '100%', 'important')
                    node.style.setProperty('max-width', '100%', 'important')
                    const renderedWidth =
                        node.getBoundingClientRect().width ||
                        node.parentElement?.getBoundingClientRect().width ||
                        widthRaw
                    const renderedHeight = (renderedWidth * heightRaw) / widthRaw
                    const resolvedHeight =
                        Number.isFinite(renderedHeight) && renderedHeight > 0
                            ? renderedHeight
                            : heightRaw

                    node.style.setProperty('height', `${resolvedHeight}px`, 'important')
                    node.style.setProperty('min-height', `${resolvedHeight}px`, 'important')
                    node.style.setProperty(
                        'aspect-ratio',
                        `${widthRaw} / ${heightRaw}`,
                        'important',
                    )
                    node.style.setProperty('visibility', 'visible', 'important')
                })
            }

            stabilizeMermaidSvgLayout()
            setTimeout(stabilizeMermaidSvgLayout, 0)
            setTimeout(stabilizeMermaidSvgLayout, 50)
            setTimeout(stabilizeMermaidSvgLayout, 250)

            const mermaidCodeBlocks = document.querySelectorAll(
                'pre[data-language="mermaid"] > code, pre > code.language-mermaid',
            )
            const legacyMermaidBlocks = Array.from(
                document.querySelectorAll('pre.mermaid, pre.mermaid-js, .mermaid'),
            ).filter((node) => {
                if (!(node instanceof HTMLElement)) return false
                if (node.matches('svg') || node.querySelector('svg, img')) {
                    return false
                }

                const source = (node.textContent ?? '').trim()
                if (source.length === 0) return false

                return /^(graph|flowchart|sequenceDiagram|classDiagram|stateDiagram|erDiagram|journey|gantt|pie|mindmap|timeline|gitGraph|quadrantChart|xychart-beta|requirementDiagram|C4Context|C4Container|C4Component|C4Dynamic|C4Deployment)\b/m.test(
                    source,
                )
            })

            if (mermaidCodeBlocks.length > 0 || legacyMermaidBlocks.length > 0) {
                const toMermaidBlock = (codeEl) => {
                    const pre = codeEl.parentElement
                    if (!pre) return

                    const container = document.createElement('div')
                    container.className = 'mermaid'
                    container.dataset.mermaid = codeEl.textContent ?? ''
                    container.textContent = container.dataset.mermaid
                    pre.replaceWith(container)
                }

                mermaidCodeBlocks.forEach((codeEl) => toMermaidBlock(codeEl))
                legacyMermaidBlocks.forEach((node) => {
                    if (!(node instanceof HTMLElement)) return
                    node.classList.add('mermaid')
                    node.dataset.mermaid = node.textContent ?? ''
                })

                const resolveMermaidTheme = () => {
                    const theme =
                        document.documentElement.getAttribute(
                            'data-webtui-theme',
                        ) ?? 'light'

                    return theme === 'light' ? 'default' : 'dark'
                }

                const resolveMermaidFontFamily = () => {
                    const fontFamily = getComputedStyle(
                        document.documentElement,
                    ).getPropertyValue('--font-family')

                    return fontFamily.trim() || 'monospace'
                }

                const resolveMermaidFontSize = () => {
                    const fontSize = getComputedStyle(
                        document.documentElement,
                    ).getPropertyValue('--font-size')

                    return fontSize.trim() || '16px'
                }

                const renderMermaid = async () => {
                    const { default: mermaid } = await import('mermaid')

                    mermaid.initialize({
                        startOnLoad: false,
                        theme: resolveMermaidTheme(),
                        fontFamily: resolveMermaidFontFamily(),
                        fontSize: resolveMermaidFontSize(),
                    })

                    const nodes = document.querySelectorAll('.mermaid')
                    nodes.forEach((node) => {
                        const source = node.dataset.mermaid
                        if (!source) return

                        node.removeAttribute('data-processed')
                        node.textContent = source
                    })

                    try {
                        await mermaid.run({ nodes })
                        stabilizeMermaidSvgLayout()
                    } catch (error) {
                        console.error('Mermaid rendering failed:', error)
                    }
                }

                renderMermaid()

                new MutationObserver(() => {
                    renderMermaid()
                }).observe(document.documentElement, {
                    attributes: true,
                    attributeFilter: ['data-webtui-theme'],
                })
            }
        </script>
    </body>
</html>
